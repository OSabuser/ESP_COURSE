# Примитивы синхронизации Embassy

Реализованы в крейте [embassy_sync](https://docs.rs/embassy-sync/0.7.2/embassy_sync/index.html)

- `Channel` - канал `MPMC` - Multi-Producer, Multi-Consumer. Каждое отправленное сообщение передается только одному потребителю.
- `PubSubChannel` - broadcast канал (publish-subscribe) `MPC` - Multi-Producer, Consumer. Каждое отправленное сообщение передается всем потребителям.
- `Signal` - передача последнего полученного значения одному потребителю.
- `Mutex` - синхронизация состояния между асинхронными задачами.
- `Pipe` - поток байт для передачи между асинхронными задачами (имплементирует `embedded_io` трейты)
  
Данные примитивы используются когда необходимо:
1.Читать/писать из/в `переменную` в нескольких задачах (`AtomicU32, Blocking Mutex`)
2.Ожидание изменения значения - принимающая задача ожидает изменения значения переменнной

## Async & Blocking Mutex

- `Async Mutex` при вызове `lock()` возвращает футуру и позволяет приостановить текущую задачу и передать управление планировщику;
- `Blocking Mutex` - при вызове `lock()` блокирует поток выполнения до получения доступа к мьютексу

`Blocking Mutex` применяется для защиты простых и быстрых операций, например, чтение/запись регистра `GPIO Pin`. `Async Mutex` - когда нужно ждать ресурс, не останавливая выполнения другой полезной работы

## Signal type

Предназначен для буферизации/передачи одного значения одному потребителю. Это осуществляется с помощью передачи задаче "Сигнала" о том, что доступно новое значение.  

## Channel type

Расширение "Сигнала", позволяет буферизировать несколько значений в очереди (FIFO). Канал позволяет нескольким производящим задачам писать в очередь и читать из нее нескольким потребителям.  
Однако, данные прочитать только один потребитель: после того как он получил данные, они не будут больше доступны для других потребителей (кто успел, тот и съел). Если очередь заполнена, то задачи-производители при очередной записи данных в очередь будут ждать пока очередь не освободится.  

## PubSubChannel type

Расширение "Канала", где данные могут потреблять несколько потребителей. Потребитель (Subscriber) может потерять значение в очереди, в случае если в нее были положены новые данные.  
Если это произошло, `PubSubChannel` вернет соответствующую ошибку
